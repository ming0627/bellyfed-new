# 2.1 Core Components Implementation (Continued)

This document continues the implementation plan for the core UI components required for the Rankings feature.

## Implementation Details (Continued)

### RankingCard Component

```tsx
// src/components/rankings/RankingCard.tsx
import React, { useState } from 'react';
import {
    Card,
    CardContent,
    CardActions,
    Typography,
    Button,
    Box,
    Chip,
    IconButton,
    Dialog,
    DialogTitle,
    DialogContent,
    DialogActions,
} from '@mui/material';
import { Edit, Delete, Photo } from '@mui/icons-material';
import { formatDistanceToNow } from 'date-fns';
import { PhotoGallery } from './PhotoGallery';
import { UserRanking } from '@/types/ranking';
import { Dish } from '@/types/dish';

interface RankingCardProps {
    ranking: UserRanking;
    dish: Dish;
    onEdit?: () => void;
    onDelete?: () => void;
    showDishInfo?: boolean;
}

export const RankingCard: React.FC<RankingCardProps> = ({
    ranking,
    dish,
    onEdit,
    onDelete,
    showDishInfo = true,
}) => {
    const [galleryOpen, setGalleryOpen] = useState(false);
    const [deleteDialogOpen, setDeleteDialogOpen] = useState(false);

    // Format the date
    const formattedDate = formatDistanceToNow(new Date(ranking.createdAt), { addSuffix: true });

    // Handle delete confirmation
    const handleDeleteConfirm = () => {
        setDeleteDialogOpen(false);
        onDelete?.();
    };

    return (
        <>
            <Card variant="outlined" sx={{ mb: 2 }}>
                <CardContent>
                    {showDishInfo && (
                        <>
                            <Typography variant="h6" gutterBottom>
                                {dish.name}
                            </Typography>
                            <Typography variant="body2" color="text.secondary" gutterBottom>
                                {dish.restaurantName}
                            </Typography>
                        </>
                    )}

                    <Box sx={{ display: 'flex', alignItems: 'center', mb: 2 }}>
                        {ranking.rank !== undefined ? (
                            <Chip
                                label={`Rank: ${ranking.rank}`}
                                color={
                                    ranking.rank <= 2
                                        ? 'success'
                                        : ranking.rank === 3
                                          ? 'warning'
                                          : 'error'
                                }
                                sx={{ mr: 1 }}
                            />
                        ) : (
                            <Chip
                                label={ranking.tasteStatus?.replace('_', ' ')}
                                color={
                                    ranking.tasteStatus === 'ACCEPTABLE'
                                        ? 'success'
                                        : ranking.tasteStatus === 'SECOND_CHANCE'
                                          ? 'warning'
                                          : 'error'
                                }
                                sx={{ mr: 1 }}
                            />
                        )}

                        {ranking.dishType && (
                            <Chip
                                label={ranking.dishType}
                                variant="outlined"
                                size="small"
                                sx={{ mr: 1 }}
                            />
                        )}

                        <Typography variant="caption" color="text.secondary" sx={{ ml: 'auto' }}>
                            {formattedDate}
                        </Typography>
                    </Box>

                    {ranking.notes && (
                        <Typography variant="body2" paragraph>
                            {ranking.notes}
                        </Typography>
                    )}

                    {ranking.photos.length > 0 && (
                        <Box sx={{ mt: 2 }}>
                            <Box sx={{ display: 'flex', alignItems: 'center', mb: 1 }}>
                                <Typography variant="subtitle2" sx={{ mr: 1 }}>
                                    Photos ({ranking.photos.length})
                                </Typography>
                                <Button
                                    size="small"
                                    startIcon={<Photo />}
                                    onClick={() => setGalleryOpen(true)}
                                >
                                    View All
                                </Button>
                            </Box>

                            <Box sx={{ display: 'flex', gap: 1, overflowX: 'auto', pb: 1 }}>
                                {ranking.photos.slice(0, 3).map((photo, index) => (
                                    <Box
                                        key={photo.id}
                                        component="img"
                                        src={photo.photoUrl}
                                        alt={`Photo ${index + 1}`}
                                        sx={{
                                            width: 80,
                                            height: 80,
                                            objectFit: 'cover',
                                            borderRadius: 1,
                                            cursor: 'pointer',
                                        }}
                                        onClick={() => setGalleryOpen(true)}
                                    />
                                ))}

                                {ranking.photos.length > 3 && (
                                    <Box
                                        sx={{
                                            width: 80,
                                            height: 80,
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            backgroundColor: 'rgba(0, 0, 0, 0.5)',
                                            borderRadius: 1,
                                            color: 'white',
                                            cursor: 'pointer',
                                        }}
                                        onClick={() => setGalleryOpen(true)}
                                    >
                                        +{ranking.photos.length - 3}
                                    </Box>
                                )}
                            </Box>
                        </Box>
                    )}
                </CardContent>

                {(onEdit || onDelete) && (
                    <CardActions sx={{ justifyContent: 'flex-end' }}>
                        {onEdit && (
                            <Button size="small" startIcon={<Edit />} onClick={onEdit}>
                                Edit
                            </Button>
                        )}

                        {onDelete && (
                            <Button
                                size="small"
                                color="error"
                                startIcon={<Delete />}
                                onClick={() => setDeleteDialogOpen(true)}
                            >
                                Delete
                            </Button>
                        )}
                    </CardActions>
                )}
            </Card>

            {/* Photo Gallery Dialog */}
            <PhotoGallery
                open={galleryOpen}
                onClose={() => setGalleryOpen(false)}
                photos={ranking.photos.map((photo) => photo.photoUrl)}
                title={dish.name}
            />

            {/* Delete Confirmation Dialog */}
            <Dialog open={deleteDialogOpen} onClose={() => setDeleteDialogOpen(false)}>
                <DialogTitle>Delete Ranking</DialogTitle>
                <DialogContent>
                    <Typography>
                        Are you sure you want to delete your ranking for {dish.name}? This action
                        cannot be undone.
                    </Typography>
                </DialogContent>
                <DialogActions>
                    <Button onClick={() => setDeleteDialogOpen(false)}>Cancel</Button>
                    <Button onClick={handleDeleteConfirm} color="error">
                        Delete
                    </Button>
                </DialogActions>
            </Dialog>
        </>
    );
};
```

### PhotoGallery Component

```tsx
// src/components/rankings/PhotoGallery.tsx
import React, { useState } from 'react';
import {
    Dialog,
    DialogTitle,
    DialogContent,
    IconButton,
    Box,
    MobileStepper,
    Button,
} from '@mui/material';
import { Close, KeyboardArrowLeft, KeyboardArrowRight } from '@mui/icons-material';
import SwipeableViews from 'react-swipeable-views';

interface PhotoGalleryProps {
    open: boolean;
    onClose: () => void;
    photos: string[];
    title?: string;
}

export const PhotoGallery: React.FC<PhotoGalleryProps> = ({ open, onClose, photos, title }) => {
    const [activeStep, setActiveStep] = useState(0);
    const maxSteps = photos.length;

    const handleNext = () => {
        setActiveStep((prevActiveStep) => prevActiveStep + 1);
    };

    const handleBack = () => {
        setActiveStep((prevActiveStep) => prevActiveStep - 1);
    };

    const handleStepChange = (step: number) => {
        setActiveStep(step);
    };

    return (
        <Dialog open={open} onClose={onClose} maxWidth="md" fullWidth>
            {title && <DialogTitle>{title}</DialogTitle>}

            <IconButton
                onClick={onClose}
                sx={{
                    position: 'absolute',
                    right: 8,
                    top: 8,
                    color: 'white',
                    backgroundColor: 'rgba(0, 0, 0, 0.5)',
                    '&:hover': {
                        backgroundColor: 'rgba(0, 0, 0, 0.7)',
                    },
                }}
            >
                <Close />
            </IconButton>

            <DialogContent sx={{ p: 0 }}>
                <SwipeableViews
                    axis="x"
                    index={activeStep}
                    onChangeIndex={handleStepChange}
                    enableMouseEvents
                >
                    {photos.map((photo, index) => (
                        <Box
                            key={index}
                            sx={{
                                height: 0,
                                paddingTop: '75%', // 4:3 aspect ratio
                                position: 'relative',
                                backgroundColor: 'black',
                            }}
                        >
                            <Box
                                component="img"
                                src={photo}
                                alt={`Photo ${index + 1}`}
                                sx={{
                                    position: 'absolute',
                                    top: 0,
                                    left: 0,
                                    width: '100%',
                                    height: '100%',
                                    objectFit: 'contain',
                                }}
                            />
                        </Box>
                    ))}
                </SwipeableViews>

                <MobileStepper
                    steps={maxSteps}
                    position="static"
                    activeStep={activeStep}
                    nextButton={
                        <Button
                            size="small"
                            onClick={handleNext}
                            disabled={activeStep === maxSteps - 1}
                        >
                            Next
                            <KeyboardArrowRight />
                        </Button>
                    }
                    backButton={
                        <Button size="small" onClick={handleBack} disabled={activeStep === 0}>
                            <KeyboardArrowLeft />
                            Back
                        </Button>
                    }
                />
            </DialogContent>
        </Dialog>
    );
};
```

### RankingStats Component

```tsx
// src/components/rankings/RankingStats.tsx
import React from 'react';
import { Box, Typography, Paper, Divider, LinearProgress, Chip } from '@mui/material';
import { RankingStats as RankingStatsType } from '@/types/ranking';

interface RankingStatsProps {
    stats: RankingStatsType;
    isLocal?: boolean;
}

export const RankingStats: React.FC<RankingStatsProps> = ({ stats, isLocal = false }) => {
    // Calculate the maximum count for scaling
    const maxRankCount = Math.max(...Object.values(stats.ranks));
    const maxTasteStatusCount = Math.max(...Object.values(stats.tasteStatuses));

    // Helper function to get percentage
    const getPercentage = (count: number, total: number) => {
        return total > 0 ? Math.round((count / total) * 100) : 0;
    };

    return (
        <Paper variant="outlined" sx={{ p: 2 }}>
            <Typography variant="h6" gutterBottom>
                {isLocal ? 'Local' : 'Global'} Statistics
            </Typography>

            <Box sx={{ mb: 2 }}>
                <Typography variant="body2" color="text.secondary" gutterBottom>
                    Based on {stats.totalRankings}{' '}
                    {stats.totalRankings === 1 ? 'ranking' : 'rankings'}
                </Typography>

                {stats.averageRank !== undefined && (
                    <Box sx={{ display: 'flex', alignItems: 'center' }}>
                        <Typography variant="body1" sx={{ mr: 1 }}>
                            Average Rank:
                        </Typography>
                        <Chip
                            label={stats.averageRank.toFixed(1)}
                            color={
                                stats.averageRank <= 2
                                    ? 'success'
                                    : stats.averageRank <= 3.5
                                      ? 'warning'
                                      : 'error'
                            }
                        />
                    </Box>
                )}
            </Box>

            <Divider sx={{ my: 2 }} />

            <Typography variant="subtitle2" gutterBottom>
                Rank Distribution
            </Typography>

            <Box sx={{ mb: 3 }}>
                {[1, 2, 3, 4, 5].map((rank) => {
                    const count = stats.ranks[rank] || 0;
                    const percentage = getPercentage(count, stats.totalRankings);

                    return (
                        <Box key={rank} sx={{ mb: 1 }}>
                            <Box sx={{ display: 'flex', alignItems: 'center', mb: 0.5 }}>
                                <Typography variant="body2" sx={{ minWidth: 60 }}>
                                    Rank {rank}:
                                </Typography>
                                <Typography variant="body2" color="text.secondary" sx={{ ml: 1 }}>
                                    {count} ({percentage}%)
                                </Typography>
                            </Box>
                            <LinearProgress
                                variant="determinate"
                                value={maxRankCount > 0 ? (count / maxRankCount) * 100 : 0}
                                color={rank <= 2 ? 'success' : rank === 3 ? 'warning' : 'error'}
                                sx={{ height: 8, borderRadius: 1 }}
                            />
                        </Box>
                    );
                })}
            </Box>

            <Typography variant="subtitle2" gutterBottom>
                Taste Status Distribution
            </Typography>

            <Box>
                {[
                    { key: 'ACCEPTABLE', label: 'Acceptable', color: 'success' },
                    { key: 'SECOND_CHANCE', label: 'Second Chance', color: 'warning' },
                    { key: 'DISSATISFIED', label: 'Dissatisfied', color: 'error' },
                ].map((status) => {
                    const count =
                        stats.tasteStatuses[status.key as keyof typeof stats.tasteStatuses] || 0;
                    const percentage = getPercentage(count, stats.totalRankings);

                    return (
                        <Box key={status.key} sx={{ mb: 1 }}>
                            <Box sx={{ display: 'flex', alignItems: 'center', mb: 0.5 }}>
                                <Typography variant="body2" sx={{ minWidth: 120 }}>
                                    {status.label}:
                                </Typography>
                                <Typography variant="body2" color="text.secondary" sx={{ ml: 1 }}>
                                    {count} ({percentage}%)
                                </Typography>
                            </Box>
                            <LinearProgress
                                variant="determinate"
                                value={
                                    maxTasteStatusCount > 0
                                        ? (count / maxTasteStatusCount) * 100
                                        : 0
                                }
                                color={status.color as 'success' | 'warning' | 'error'}
                                sx={{ height: 8, borderRadius: 1 }}
                            />
                        </Box>
                    );
                })}
            </Box>
        </Paper>
    );
};
```

## Testing

- [ ] Write unit tests for RankingCard component

    - Test rendering with different ranking types
    - Test photo gallery integration
    - Test edit and delete functionality

- [ ] Write unit tests for PhotoGallery component

    - Test navigation between photos
    - Test swipe functionality

- [ ] Write unit tests for RankingStats component
    - Test rendering with different statistics
    - Test percentage calculations

## Dependencies

- Material UI for UI components
- React Swipeable Views for photo gallery
- date-fns for date formatting

## Estimated Time

- RankingCard Component: 1 day
- PhotoGallery Component: 0.5 day
- RankingStats Component: 1 day
- Testing: 1 day

Total: 3.5 days
